---
title: "Build Type: GCB Triggered Build"
layout: standard
hero_text: |
    A [SLSA Provenance](/provenance/v1) `buildType` that describes a build
    executed by Google Cloud Build reading the build configuration from source.
---

## Description

```jsonc
"buildType": "https://slsa.dev/gcb-triggered-build/v1?draft"
```

This `buildType` describes the execution of a [Google Cloud Build (GCB)][GCB]
build where GCB read the build configuration from a file in a source repository,
usually called cloudbuild.yaml. This is only possible via a [Trigger], though
theoretically a future API or CLI call could do the same.

This `buildType` MUST NOT be used to describe:

-   Cases where GCB did not verify that the build configuration came from a
    source repository. This includes [local builds] that send the [Build] over
    the wire, as well as [Triggers][Trigger] that set an explicit `build`. (If
    desired, a separate `buildType` could be created for that purpose.)
-   Pull request events. The semantics are confusing in the context of SLSA
    since the build is not of the target but of the source, so to be safe these
    are unsupported.

If you have a use case for supporting these, please open a [GitHub Issue][SLSA
Issues].

[Build]: https://cloud.google.com/build/docs/api/reference/rest/v1/projects.builds
[GCB]: https://cloud.google.com/build/docs/api/reference/rest
[SLSA Issues]: https://github.com/slsa-framework/slsa/issues
[Trigger]: https://cloud.google.com/build/docs/api/reference/rest/v1/projects.triggers
[local builds]: https://cloud.google.com/build/docs/running-builds/submit-build-via-cli-api

## Build Definition

### External parameters

[External parameters]: #external-parameters

All external parameters are REQUIRED unless otherwise noted.

> ⚠ **RFC:** Do we need the project and `serviceAccount`? Does it affect the
> build? Should we trust a build under any project/account, or is that part of
> the trust base? Should it go in `builder.id`?

> ⚠ **RFC:** Do we need `repoType` from
> [GitFileSource](https://cloud.google.com/build/docs/api/reference/rest/v1/projects.locations.triggers#BuildTrigger.GitFileSource)?
> How can that be used to affect the build?

> ⚠ **RFC:** Does this cover all of the ways to externally influence the build? Is
> anything missing?

<table>
<tr><th>Parameter<th>Type<th>Description

<tr id="configSource"><td><code>configSource</code><td>object<td>

Location from which the build configuration was read.

In BuildTrigger, this corresponds to `gitFileSource` if set, else
`sourceToBuild` (which falls back to the commit that triggered the build, for
repo-based triggers).

<tr id="configSource.ref"><td><code>configSource.ref</code><td>object<td>

Git reference within `repository` from which the configuration was read, as
either a fully qualified git ref (starting with `refs/`) or a commit SHA
(lowercase hex). A commit SHA is only used if specified in the trigger.

<tr id="configSource.repository"><td><code>configSource.repository</code><td>string<td>

HTTPS URI of the git repository, with `https://` protocol and without `.git`
suffix.

<tr id="configSource.path"><td><code>configSource.path</code><td>string<td>

Path to the build configuration file within the commit. Example:
`cloudbuild.yaml`

Mutually exclusive with `pathAutodetect`. Exactly one of these fields MUST be
set.

<tr id="configSource.pathAutodetect"><td><code>configSource.pathAutodetect</code><td>boolean<td>

If true, `path` was autodetected, corresponding to the `autodetect` option in
the BuildTrigger. This MUST NOT be set to false; use `path` instead if
autodetection was not enabled.

Mutually exclusive with `path`. Exactly one of these fields MUST be set.

<tr id="sourceToBuild"><td><code>sourceToBuild</code><td>object<td>

Source code that was checked out and built. Normally this is the same as
`configSource`; it only differs if the BuildTrigger had `gitFileSource` set.

This field SHOULD be omitted if all subfields are empty, i.e. if the commit is
the same as same as `configSource` and `dir` is empty.

In BuildTrigger, this corresponds to `sourceToBuild` (which falls back to the
commit that triggered the build, for repo-based triggers).

<tr id="sourceToBuild.ref"><td><code>sourceToBuild.ref</code><td>string<td>

Git reference within `repository` that was checked out, as either a fully
qualified git ref (starting with `refs/`) or a commit SHA (lowercase hex). A
commit SHA is only used if specified in the trigger.

<tr id="sourceToBuild.repository"><td><code>sourceToBuild.repository</code><td>string<td>

HTTPS URI of the git repository, with `https://` protocol and without `.git`
suffix.

<tr id="sourceToBuild.dir"><td><code>sourceToBuild.dir</code><td>string<td>

Directory within the commit in which to run the build, without a trailing slash.
Can be empty / unset.

<tr id="substitutions"><td><code>substitutions</code><td>object<td>

Map of (string -> string) containing the substitutions to perform on the Build
resource.

</table>

### System parameters

> **TODO:** Any system parameters? Perhaps the trigger resource URI? Customer
> org and project?

### Resolved dependencies

The `resolvedDependencies` SHOULD contain entries identifying the resolved git
commit IDs corresponding to `externalParameters.configSource` and
`externalParameters.sourceToBuild`. The dependencies' `uri` MUST be in [SPDX
Download Location] format, i.e. `"git+" + repository + "@" + ref`. See
[Example].

The `resolvedDependencies` MAY contain additional artifacts known to be input
to the workflow.

[SPDX Download Location]: https://spdx.github.io/spdx-spec/v2.3/package-information/#77-package-download-location-field

## Run details

### Builder

> **TODO:** How should we populate `builder.id`? Should it include the tenant
> project (and/or service account)?

### Metadata

> **TODO:** Is there a URI we can use for `invocationId`?

## Example

[Example]: #example

```json
{% include_relative examples/v1/example.json %}
```

## Version history

### v1

Initial version
